<!DOCTYPE html>
<html>
<head>
    <title>Database Configuration</title>
    <style>
        body { max-width: 800px; margin: 0 auto; padding: 20px; font-family: Arial; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 8px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Database Configuration</h1>
    <form id="configForm">
        <div class="form-group">
            <label for="host">Host:</label>
            <input type="text" id="host" name="host" required>
        </div>
        <div class="form-group">
            <label for="user">User:</label>
            <input type="text" id="user" name="user" required>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
        </div>
        <div class="form-group">
            <label for="database">Database:</label>
            <input type="text" id="database" name="database" required>
        </div>
        <button type="submit">Save Configuration</button>
    </form>
    <div id="message"></div>

    <script>

       document.addEventListener('DOMContentLoaded', () => {
    fetch('/api/config')
        .then(res => res.json())
        .then(config => {
            console.log('Loaded config:', config); // Debug line
            Object.keys(config).forEach(key => {
                const input = document.getElementById(key);
                if (input) {
                    input.value = config[key];
                }
            });
        })
        .catch(err => {
            console.error('Error loading config:', err);
            document.getElementById('message').innerHTML = 
                '<p class="error">Failed to load current configuration</p>';
        });
});

        // Update the form submit handler script section
document.getElementById('configForm').onsubmit = async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const config = Object.fromEntries(formData);
    const messageDiv = document.getElementById('message');
    
    try {
        const response = await fetch('/api/config', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(config)
        });
        
        if (response.ok) {
            messageDiv.innerHTML = '<p class="success">Configuration saved! Server is restarting...</p>';
            
            // Check server and database connection
            setTimeout(async function checkConnection() {
                try {
                    // Test database connection endpoint
                    const dbCheck = await fetch('/api/testConnection');
                    if (dbCheck.ok) {
                        messageDiv.innerHTML += '<p class="success">✅ Server restarted and database connected successfully!</p>';
                    } else {
                        messageDiv.innerHTML += '<p class="error">❌ Database connection failed. Please verify your configuration and try again.</p>';
                    }
                } catch (error) {
                    // Server still restarting, try again
                    messageDiv.innerHTML = '<p>Waiting for server to restart...</p>';
                    setTimeout(checkConnection, 1000);
                }
            }, 2000);
        }
    } catch (error) {
        messageDiv.innerHTML = `<p class="error">Error: ${error.message}</p>`;
    }
};

    </script>
</body>
</html>
